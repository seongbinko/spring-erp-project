<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.co.jhta.erp.dao.AttendanceDao">
	
	<insert id="addEmployeeAttendance" parameterType="Attendance">
		<selectKey keyProperty="no" resultType="int" order="BEFORE">
			select
				attendance_no_seq.nextval
			from
				dual
		</selectKey>
		insert into Attendances
		(attendance_no, in_time, employee_no, attendance_date)
		values
		(#{no}, #{inTime}, #{employeeNo}, to_char(#{attendanceDate}, 'yyyy-mm-dd'))
	</insert>
	
	<select id="getAttendanceTodayByEmpNo" parameterType="int" resultType="Attendance">
		select
			attendance_no		no, 
			in_time				inTime, 
			out_time 			outTime,
			attendance_status  	status,
			employee_no			employeeNo, 
			overtime_amount		overtimeAmount, 
			attendance_date		attendanceDate
		from
			attendances
		where
			employee_no = #{employeeNo}
			and attendance_date = to_char(sysdate, 'yyyy-mm-dd')
	</select>
	
	<update id="updateEmployeeAttendance" parameterType="Attendance">
		update 
			attendances
		set
			out_time 		  =		#{outTime},
			attendance_status =		#{status},
			overtime_amount	  =		#{overtimeAmount} 
		where
			attendance_no = #{no}
	</update>
</mapper> 